<%page expression_filter="h"/>
<%inherit file="base.html" />
<%def name="online_help_token()"><% return "schedule" %></%def>
<%block name="title">${_("Schedule & Details Settings")}</%block>
<%block name="bodyclass">is-signedin course schedule view-settings feature-upload</%block>

<%namespace name='static' file='static_content.html'/>
<%!
  from django.utils.translation import gettext as _
  from common.djangoapps.student.auth import has_studio_advanced_settings_access
  from cms.djangoapps.contentstore import utils
  from lms.djangoapps.certificates.api import can_show_certificate_available_date_field
  from openedx.core.djangolib.js_utils import (
      dump_js_escaped_json, js_escaped_string
  )
  from openedx.core.djangolib.markup import HTML, Text
  import six
  from six.moves.urllib.parse import quote
  from six.moves.urllib import parse as urllib
%>

<%block name="header_extras">
% for template_name in ["basic-modal", "modal-button", "upload-dialog", "license-selector", "course-settings-learning-fields", "course-instructor-details"]:
  <script type="text/template" id="${template_name}-tpl">
    <%static:include path="js/${template_name}.underscore" />
  </script>
% endfor
</%block>

<%block name="jsextra">
  <link rel="stylesheet" type="text/css" href="${static.url('js/vendor/timepicker/jquery.timepicker.css')}" />

  <script type="text/javascript">
window.CMS = window.CMS || {};
CMS.URL = CMS.URL || {};
CMS.URL.UPLOAD_ASSET = '${upload_asset_url | n, js_escaped_string}'
  </script>
</%block>

<%block name="requirejs">
    require(["js/factories/settings"], function(SettingsFactory) {
        SettingsFactory(
            "${details_url | n, js_escaped_string}",
            ${show_min_grade_warning | n, dump_js_escaped_json},
            ${can_show_certificate_available_date_field(context_course) | n, dump_js_escaped_json},
            "${upgrade_deadline | n, js_escaped_string}",
            ${settings.FEATURES.get("ENABLE_V2_CERT_DISPLAY_SETTINGS") | n, dump_js_escaped_json}
        );
    });
</%block>

<%block name="content">
<div class="wrapper-mast wrapper">
  <header class="mast has-subtitle">
    <h1 class="page-header">
      <small class="subtitle">${_("Settings")}</small>
      <span class="sr">&gt; </span>${_("Schedule & Details")}
    </h1>
  </header>
</div>

<div class="wrapper-content wrapper">
  <div class="content">
    <div class="content-primary">
      <form id="settings_details" class="settings-details" method="post" action="">
        <div class="group-settings basic">
          <header>
            <h2 class="title-2">${_("Basic Information")}</h2>
            <span class="tip">${_("The nuts and bolts of your course")}</span>
          </header>

          <ol class="list-input">
            <li class="field text is-not-editable" id="field-course-organization">
              <label for="course-organization">${_("Organization")}</label>
              <input title="${_('This field is disabled: this information cannot be changed.')}" type="text"
                class="long" id="course-organization" readonly />
            </li>

            <li class="field text is-not-editable" id="field-course-number">
              <label for="course-number">${_("Course Number")}</label>
              <input title="${_('This field is disabled: this information cannot be changed.')}" type="text"
                class="short" id="course-number" readonly>
            </li>

            <li class="field text is-not-editable" id="field-course-name">
              <label for="course-name">${_("Course Run")}</label>
              <input title="${_('This field is disabled: this information cannot be changed.')}" type="text"
                class="long" id="course-name" readonly />
            </li>
          </ol>
        </div>
        <hr class="divide" />

        % if credit_eligibility_enabled and is_credit_course:
          <div class="group-settings basic">
            <header>
              <h2 class="title-2">${_("Course Credit Requirements")}</h2>
              <span class="tip">${_("Steps required to earn course credit")}</span>
            </header>
            <span class="header-help tip">A requirement appears in this list when you publish the unit that contains the requirement.</span>

              % if credit_requirements:
                <ol class="list-input">
                  % if 'grade' in credit_requirements:
                    <li class="field text is-not-editable" id="credit-minimum-passing-grade">
                      <label>${_("Minimum Grade")}</label>
                        % for requirement in credit_requirements['grade']:
                          <label for="${requirement['name']}" class="sr">${_("Minimum Grade")}</label>
                          <input title="${_('This field is disabled: this information cannot be changed.')}" type="text"
                              class="long" id="${requirement['name']}" value="${'{0:.0f}%'.format(float(requirement['criteria']['min_grade'] or 0)*100)}" readonly />
                        % endfor
                    </li>
                  % endif

                  % if 'proctored_exam' in credit_requirements:
                    <li class="field text is-not-editable" id="credit-proctoring-requirements">
                      <label>${_("Successful Proctored Exam")}</label>
                        % for requirement in credit_requirements['proctored_exam']:
                          <label for="${requirement['name']}" class="sr">${_('Proctored Exam {number}').format(number=loop.index+1)}</label>
                          <input title="${_('This field is disabled: this information cannot be changed.')}" type="text"
                              class="long" id="${requirement['name']}" value="${requirement['display_name']}" readonly />
                        % endfor
                    </li>
                  % endif

                  % if 'reverification' in credit_requirements:
                    <li class="field text is-not-editable" id="credit-reverification-requirements">
                      <label>${_("ID Verification")}</label>
                        % for requirement in credit_requirements['reverification']:
                          <label for="${requirement['name']}" class="sr">${_('In-Course Reverification {number}').format(number=loop.index+1)}</label>
                          <input title="${_('This field is disabled: this information cannot be changed.')}" type="text"
                              class="long" id="${requirement['name']}" value="${requirement['display_name']}" readonly />
                        % endfor
                    </li>
                  % endif
                </ol>
              % else:
                <p>No credit requirements found.</p>
              % endif
          </div>
          <hr class="divide" />
        % endif

        <div class="group-settings pacing">
          <fieldset role="radiogroup">
            <legend>
              <header>
                <h2 class="title-2">${_("Course Pacing")}</h2>
                <span class="tip">${_("Set the pacing for this course")}</span>
              </header>
            </legend>
            <span class="msg" id="course-pace-toggle-tip"></span>

            <ol class="list-input">
                <li class="field">
                  <input type="radio" class="field-radio" name="self-paced" id="course-pace-instructor-paced" value="false" aria-labelledby="course-pace-instructor-label" />
                  <label id="course-pace-instructor-label" class="course-pace-label" for="course-pace-instructor-paced">${_("Instructor-Paced")}</label>
                  <span class="tip">${_("Instructor-paced courses progress at the pace that the course author sets. You can configure release dates for course content and due dates for assignments.")}</span>
                </li>
                <li class="field">
                  <input type="radio" class="field-radio" name="self-paced" id="course-pace-self-paced" value="true" aria-labelledby="course-pace-self-paced-label"/>
                  <label id="course-pace-self-paced-label" class="course-pace-label" for="course-pace-self-paced">${_("Self-Paced")}</label>
                  <span class="tip">${_("Self-paced courses offer suggested due dates for assignments or exams based on the learnerâ€™s enrollment date and the expected course duration. These courses offer learners flexibility to modify the assignment dates as needed.")}</span>
                </li>
            </ol>
          </fieldset>
        </div>

        <hr class="divide" />

        <div id="schedule" class="group-settings schedule">
          <header>
            <h2 class="title-2">${_('Course Schedule')}</h2>
            <span class="tip">${_('Dates that control when your course can be viewed')}</span>
          </header>

          <ol class="list-input">
            <li class="field-group field-group-course-start" id="course-start">
              <div class="field date" id="field-course-start-date">
                <label for="course-start-date">${_("Course Start Date")}</label>
                <input type="text" class="start-date date start datepicker" id="course-start-date" placeholder="MM/DD/YYYY" autocomplete="off" />
                <span class="icon icon-inline fa fa-calendar-check-o datepicker-icon" aria-hidden="true"></span>
                <span class="tip tip-stacked">${_("First day the course begins")}</span>
              </div>

              <div class="field time" id="field-course-start-time">
                <label for="course-start-time">${_("Course Start Time")}</label>
                <input type="text" class="time start timepicker" id="course-start-time" value="" placeholder="HH:MM" autocomplete="off" />
                <span class="tip tip-stacked timezone">${_("(UTC)")}</span>
              </div>
            </li>

            <li class="field-group field-group-course-end" id="course-end">
              <div class="field date" id="field-course-end-date">
                <label for="course-end-date">${_("Course End Date")}</label>
                <input type="text" class="end-date date end" id="course-end-date" placeholder="MM/DD/YYYY" autocomplete="off" />
                <span class="icon icon-inline fa fa-calendar-check-o datepicker-icon" aria-hidden="true"></span>
                <span class="tip tip-stacked">${_("Last day your course is active")}</span>
              </div>

              <div class="field time" id="field-course-end-time">
                <label for="course-end-time">${_("Course End Time")}</label>
                <input type="text" class="time end" id="course-end-time" value="" placeholder="HH:MM" autocomplete="off" />
                <span class="tip tip-stacked timezone">${_("(UTC)")}</span>
              </div>
            </li>
          </ol>

          <%
            use_v2_cert_display_settings = settings.FEATURES.get("ENABLE_V2_CERT_DISPLAY_SETTINGS", False)
          %>
          % if can_show_certificate_available_date_field(context_course):
          <ol class="list-input">
            <li class="field-group field-group-certificate-available" id="certificate-available">
              <div class="field date" id="field-certificates-display-behavior">
                <label for="certificates-display-behavior">${_("Certificates Display Behavior")}</label>
                % if use_v2_cert_display_settings:
                  <select id="certificates-display-behavior">
                    <option value="early_no_info">${_("Immediately upon passing")}</option>
                    <option value="end">${_("End date of course")}</option>
                    <option value="end_with_date">${_("A date after the course end date")}</option>
                  </select>
                % else:
                  <input id="certificates-display-behavior" type="text">
                % endif
                <span class="tip tip-stacked">${_("Certificates are awarded at the end of a course run")}</span>

                % if use_v2_cert_display_settings:
                  <!-- Collapsible -->
                  <div class="collapsible">
                    <div id="certificate-display-behavior-collapsible-trigger" class="collapsible-trigger" role="button" tabindex="0" aria-expanded="false">
                      <span>
                        <span class="icon icon-inline fa fa-info-circle" aria-hidden="true"></span>
                        ${_("Read more about this setting")}
                      </span>
                    </div>
                    <div id="certificate-display-behavior-collapsible-content" class="collapsible-content collapsed">
                      <p>${_("In all configurations of this setting, certificates are generated for learners as soon as they achieve the passing threshold in the course (which can occur before a final assignment based on course design)")}</p>
                      <div>
                        <div class="collapsible-description-heading">${_("Immediately upon passing")}</div>
                        <div class="collapsible-description-description">${_("Learners can access their certificate as soon as they achieve a passing grade above the course grade threshold. Note: learners can achieve a passing grade before encountering all assignments in some course configurations.")}</div>
                      </div>
                      <div>
                        <div class="collapsible-description-heading">${_("On course end date")}</div>
                        <div class="collapsible-description-description">${_("Learners with passing grades can access their certificate once the end date of the course has elapsed.")}</div>
                      </div>
                      <div>
                        <div class="collapsible-description-heading">${_("A date after the course end date")}</div>
                        <div class="collapsible-description-description">${_("Learners with passing grades can access their certificate after the date that you set has elapsed.")}</div>
                      </div>
                    </div>
                  </div>
                % endif
              </div>

              % if use_v2_cert_display_settings:
                <div class="field date hidden" id="field-certificate-available-date" >
              % else:
                <div class="field date" id="field-certificate-available-date" >
              % endif
                <label for="certificate-available-date">${_("Certificates Available Date")}</label>
                <input type="text" class="certificate-available-date date start datepicker" id="certificate-available-date" placeholder="MM/DD/YYYY" autocomplete="off" />
                <span class="icon icon-inline fa fa-calendar-check-o datepicker-icon" aria-hidden="true"></span>
              </div>
            </li>
          </ol>
          % endif

          <ol class="list-input">
            <li class="field-group field-group-enrollment-start" id="enrollment-start">
              <div class="field date" id="field-enrollment-start-date">
                <label for="course-enrollment-start-date">${_("Enrollment Start Date")}</label>
                <input type="text" class="start-date date start" id="course-enrollment-start-date" placeholder="MM/DD/YYYY" autocomplete="off" />
                <span class="icon icon-inline fa fa-calendar-check-o datepicker-icon" aria-hidden="true"></span>
                <span class="tip tip-stacked">${_("First day students can enroll")}</span>
              </div>

              <div class="field time" id="field-enrollment-start-time">
                <label for="course-enrollment-start-time">${_("Enrollment Start Time")}</label>
                <input type="text" class="time start" id="course-enrollment-start-time" value="" placeholder="HH:MM" autocomplete="off" />
                <span class="tip tip-stacked timezone">${_("(UTC)")}</span>
              </div>
            </li>
            <%
              enrollment_end_readonly = HTML("readonly aria-readonly=\"true\"") if not enrollment_end_editable else ""
              enrollment_end_editable_class = "is-not-editable" if not enrollment_end_editable else ""
            %>
            <li class="field-group field-group-enrollment-end" id="enrollment-end">
              <div class="field date ${enrollment_end_editable_class}" id="field-enrollment-end-date">
                <label for="course-enrollment-end-date">${_("Enrollment End Date")}</label>
                <input type="text" class="end-date date end" id="course-enrollment-end-date" placeholder="MM/DD/YYYY" autocomplete="off" ${enrollment_end_readonly} />
                <span class="icon icon-inline fa fa-calendar-check-o datepicker-icon" aria-hidden="true"></span>
                <span class="tip tip-stacked">
                  ${_("Last day students can enroll.")}
                % if not enrollment_end_editable:
                  ${_("Contact your {platform_name} partner manager to update these settings.").format(platform_name=settings.PLATFORM_NAME)}
                % endif
                </span>
              </div>

              <div class="field time ${enrollment_end_editable_class}" id="field-enrollment-end-time">
                <label for="course-enrollment-end-time">${_("Enrollment End Time")}</label>
                <input type="text" class="time end" id="course-enrollment-end-time" value="" placeholder="HH:MM" autocomplete="off" ${enrollment_end_readonly} />
                <span class="tip tip-stacked timezone">${_("(UTC)")}</span>
              </div>
            </li>
          </ol>

          % if upgrade_deadline:
          <ol class="list-input">
            <li class="field-group field-group-upgrade-deadline" id="upgrade-deadline">
              <div class="field date is-not-editable" id="field-upgrade-deadline-date">
                <label for="course-upgrade-deadline-date">${_("Upgrade Deadline Date")}</label>
                <input type="text" class="date upgrade-deadline" id="course-upgrade-deadline-date" placeholder="MM/DD/YYYY" autocomplete="off" readonly aria-readonly="true" />
                <span class="tip tip-stacked">
                  ${_("Last day students can upgrade to a verified enrollment.")}
                  ${_("Contact your {platform_name} partner manager to update these settings.").format(platform_name=settings.PLATFORM_NAME)}
                </span>
              </div>

              <div class="field time is-not-editable" id="field-upgrade-deadline-time">
                <label for="course-upgrade-deadline-time">${_("Upgrade Deadline Time")}</label>
                <input type="text" class="time upgrade-deadline" id="course-upgrade-deadline-time" placeholder="HH:MM" autocomplete="off" readonly aria-readonly="true" />
                <span class="tip tip-stacked timezone">${_("(UTC)")}</span>
              </div>
            </li>
          </ol>
          % endif
        </div>

        % if about_page_editable:
        <div class="group-settings course_details">
          <header>
            <h2 class="title-2">${_('Course Details')}</h2>
            <span class="tip">${_('Provide useful information about your course')}</span>
          </header>
          <ol class="list-input">
            <li class="field" id="field-course-language">
              <label for="course-language">${_("Course Language")}</label>
              <select id="course-language">
                <option value="" selected> - </option>
                % for lang, label in language_options:
                  <option value="${lang}">${label}</option>
                % endfor
              </select>
              <span class="tip tip-stacked">${_("Identify the course language here. This is used to assist users find courses that are taught in a specific language. It is also used to localize the 'From:' field in bulk emails.")}</span>
            </li>
          </ol>
        </div>
        % endif
      </form>
    </div>
    <div class="content-supplementary" role="complementary">
     <div class="bit">
        <h3 class="title-3">${_("How are these settings used?")}</h3>
        <p>${_("Your course's schedule determines when students can enroll in and begin a course.")}</p>

        <p>${_("Other information from this page appears on the About page for your course. This information includes the course overview, course image, introduction video, and estimated time requirements. Students use About pages to choose new courses to take.")}</p>
     </div>

     <div class="bit">
     % if context_course:
          <%
            url_encoded_course_id = quote(six.text_type(context_course.id).encode('utf-8'), safe='')
            course_team_url = utils.reverse_course_url('course_team_handler', context_course.id)
            grading_config_url = utils.reverse_course_url('grading_handler', context_course.id)
            advanced_config_url = utils.reverse_course_url('advanced_settings_handler', context_course.id)
          %>
        <h3 class="title-3">${_("Other Course Settings")}</h3>
        <nav class="nav-related" aria-label="${_('Other Course Settings')}">
          <ul>
            <li class="nav-item"><a href="${grading_config_url}">${_("Grading")}</a></li>
            <!-- <li class="nav-item"><a href="${course_team_url}">${_("Course Team")}</a></li> -->
            <li class="nav-item"><a href="${utils.reverse_course_url('group_configurations_list_handler', context_course.id)}">${_("Group Configurations")}</a></li>
            % if has_studio_advanced_settings_access(request.user):
            <li class="nav-item"><a href="${advanced_config_url}">${_("Advanced Settings")}</a></li>
            % endif
            % if mfe_proctored_exam_settings_url:
              <li class="nav-item"><a href="${mfe_proctored_exam_settings_url}">${_("Proctored Exam Settings")}</a></li>
            % endif
          </ul>
        </nav>
     % endif
     </div>
    </div>
  </div>
</div>
</%block>
